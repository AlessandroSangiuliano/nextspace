#import <NXSystem/NXScreen.h>
#include <unistd.h>

int main(int argc, const char ** argv)
{
  NXScreen *sScreen;
  NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];
  BOOL isActive = NO;
  
  sScreen = [NXScreen sharedScreen];

  for (NXDisplay *display in [sScreen allDisplays])
    {
      if (![display isConnected])
        {
          NSLog(@"Display at output '%@' is not Connected",
                [display outputName]);
          continue;
        }

      isActive = [display isActive];
      if (!isActive)
        {
          NSLog(@"Display at output '%@' (Inactive)",
                [display outputName]);
        }
      else
        {
          NSLog(@"Display at output: %@", [display outputName]);
          if ([display isMain])
            NSLog(@"\tMain Display: YES");
        }
      
      NSLog(@"\tCRTC: %lu", [display crtcID]);
      
      NSSize size = [display physicalSize];
      NSLog(@"\tSize: %.0fmm x %.0fmm", size.width, size.height);
      
      NSLog(@"\tResolutions:");
      for (NSDictionary *res in [display allModes])
        {
          NSLog(@"\t\t%@", [res objectForKey:@"Name"]);
        }
      
      if (isActive)
        {
          NSDictionary *mode = [display mode];
          if (mode)
            {
              NSLog(@"\tCurrent resolution: %.0f x %.0f @ %.2f",
                    [[mode objectForKey:@"Width"] floatValue],
                    [[mode objectForKey:@"Height"] floatValue],
                    [[mode objectForKey:@"Rate"] floatValue]);
            }
          // else
          //   {
          //     NSLog(@"\tCurrent resolution (%.0fx%.0f@%.2f) is not in list of supported by monitor", [display modeSize].width, [display modeSize].height, [display modeRate]);
          //   }
          mode = [display preferredMode];
          NSLog(@"\tPreferred resolution: %.0f x %.0f @ %.2f",
                [[mode objectForKey:@"Width"] floatValue],
                [[mode objectForKey:@"Height"] floatValue],
                [[mode objectForKey:@"Rate"] floatValue]);
      
          NSRect frame = [display frame];
          NSLog(@"\tPosition: %.1f, %.1f", frame.origin.x, frame.origin.y);
          NSLog(@"\tSize in pixels: %.1f x %.1f", frame.size.width, frame.size.height);
          NSLog(@"\tDots per Inch: %.1f", [display dpi]);
        }
    }

  // [sScreen defaultLayout];
//  [sScreen applyDisplayLayout:[sScreen defaultLayout:YES]];
  // sleep(3);
  [sScreen applyDisplayLayout:[sScreen defaultLayout:NO]];
  
  [pool release];

  return 0;
}
