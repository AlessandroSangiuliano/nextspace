#!/bin/sh
#
# Copyright (c) 2004-2009 Sergii Stoian
#

# PROVIDE: GNUstep
# REQUIRE: NETWORK
# BEFORE: LOGIN
# KEYWORD:

test -f /Developer/Makefiles/GNUstep.sh || exit 0
. /Developer/Makefiles/GNUstep.sh
. /usr/NextSpace/etc/profile

ID=`/usr/bin/id -u`
USER=`whoami`

# Log file
GS_SECURE="/tmp/GNUstepSecure"$ID
LOGFILE="$GS_SECURE/console.log"
if [ ! -d $GS_SECURE ];then
    mkdir $GS_SECURE
    chmod 700 $GS_SECURE
fi

case "$1" in

start)
	printf "Starting GNUstep services:"
	if [ "$ID" = "0" ];
	then
	    gdomap -p > $LOGFILE 2>&1 &
	    printf " gdomap"
	fi
	gdnc --daemon > $LOGFILE 2>&1 &
	printf " gdnc"
	gpbs --daemon > $LOGFILE 2>&1 &
	printf " gpbs"
	printf ".\n"
	;;  
stop)
	printf "Stopping GNUstep services:"
	killall -u me -9 gpbs
	printf " gpbs"
	killall -u me -9 gdnc
	printf " gdnc"
	if [ "$ID" = "0" ];
	then
	    killall -9 gdomap
	    printf " gdomap"
	fi
	printf ".\n"
	;;
status)
	echo `ps auxw | grep $USER | grep gdomap | awk '{print $2}'`
	echo `ps auxw | grep $USER | grep gdnc | awk '{print $2}'`
	echo `ps auxw | grep $USER | grep gpbs | awk '{print $2}'`
	;;
*)
	printf "Usage: $0 {start|stop|status}\n"
	exit 1
	;;
esac
